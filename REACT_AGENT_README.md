# ReAct Agent - æ™ºèƒ½æ¨ç†åŠ©æ‰‹

## æ¦‚è¿°

ReAct Agentæ˜¯åŸºäºReasoning and Actingæ¨¡å¼çš„æ™ºèƒ½åŠ©æ‰‹ï¼Œå®ƒèƒ½å¤Ÿé€šè¿‡å¤šè½®æ¨ç†å’Œå·¥å…·è°ƒç”¨æ¥å›ç­”å¤æ‚é—®é¢˜ã€‚ç›¸æ¯”ä¼ ç»Ÿçš„å•æ¬¡æŸ¥è¯¢RAG Agentï¼ŒReAct Agentå…·æœ‰æ›´å¼ºçš„æ¨ç†èƒ½åŠ›å’Œä¿¡æ¯æ•´åˆèƒ½åŠ›ã€‚

## æ ¸å¿ƒç‰¹æ€§

### ğŸ§  ReActæ¨ç†æ¨¡å¼
- **æ€è€ƒ(Think)**: åˆ†æé—®é¢˜ï¼Œåˆ¶å®šä¸‹ä¸€æ­¥ç­–ç•¥
- **è¡ŒåŠ¨(Act)**: è°ƒç”¨åˆé€‚çš„å·¥å…·è·å–ä¿¡æ¯
- **è§‚å¯Ÿ(Observe)**: åˆ†æå·¥å…·è¿”å›çš„ç»“æœ
- **å¾ªç¯**: ç›´åˆ°æœ‰è¶³å¤Ÿä¿¡æ¯ç»™å‡ºç­”æ¡ˆ

### ğŸ”§ ä¸°å¯Œçš„RAGå·¥å…·
- `rag_search`: åœ¨çŸ¥è¯†åº“ä¸­æœç´¢ç›¸å…³æ–‡æ¡£
- `rag_get_context`: è·å–ç‰¹å®šç¬”è®°çš„å®Œæ•´ä¸Šä¸‹æ–‡
- `rag_multi_query`: æ‰§è¡Œå¤šä¸ªç›¸å…³æŸ¥è¯¢å¹¶åˆå¹¶ç»“æœ
- `rag_get_stats`: è·å–çŸ¥è¯†åº“ç»Ÿè®¡ä¿¡æ¯

### ğŸ“Š æ™ºèƒ½æ§åˆ¶
- æœ€å¤š5æ¬¡å·¥å…·è°ƒç”¨é™åˆ¶ï¼ˆå¯é…ç½®ï¼‰
- æœ€å¤š10æ­¥æ¨ç†é™åˆ¶ï¼ˆå¯é…ç½®ï¼‰
- è‡ªåŠ¨ç½®ä¿¡åº¦è¯„ä¼°
- è¯¦ç»†çš„æ¨ç†è¿‡ç¨‹è®°å½•

## å®‰è£…å’Œé…ç½®

### ç¯å¢ƒè¦æ±‚
- Python 3.8+
- OpenAI API Key
- æ€æºç¬”è®°ï¼ˆå¯é€‰ï¼Œç”¨äºæ„å»ºçŸ¥è¯†åº“ï¼‰

### ç¯å¢ƒå˜é‡
```bash
export OPENAI_API_KEY="your-openai-api-key"
export OPENAI_BASE_URL="https://api.openai.com/v1"  # å¯é€‰
```

### å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

## å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ä½¿ç”¨

```python
import asyncio
from utils.rag.rag_knowledge_base import create_rag_knowledge_base
from utils.agent.react_agent import create_react_agent

async def main():
    # åˆ›å»ºçŸ¥è¯†åº“
    rag_kb = create_rag_knowledge_base()

    # åˆ›å»ºReAct Agent
    agent = create_react_agent(
        knowledge_base=rag_kb,
        model="gpt-3.5-turbo",
        max_tool_calls=5
    )

    # æ‰§è¡ŒæŸ¥è¯¢
    response = await agent.query("è¯·åˆ†æé¡¹ç›®ä¸­çš„æ•°æ®å¤„ç†æµç¨‹")

    # æŸ¥çœ‹ç»“æœ
    print(f"ç­”æ¡ˆ: {response.answer}")
    print(f"å·¥å…·è°ƒç”¨æ¬¡æ•°: {response.tool_calls_made}")
    print(f"æ¨ç†æ­¥éª¤: {len(response.reasoning)}")
    print(f"ç½®ä¿¡åº¦: {response.final_confidence}")

asyncio.run(main())
```

### é«˜çº§é…ç½®

```python
# è‡ªå®šä¹‰ç³»ç»Ÿæç¤ºè¯
custom_prompt = """
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æŠ€æœ¯æ–‡æ¡£åˆ†æå¸ˆã€‚
è¯·ä»”ç»†åˆ†æç”¨æˆ·é—®é¢˜ï¼Œä½¿ç”¨åˆé€‚çš„å·¥å…·æŸ¥æ‰¾ä¿¡æ¯ï¼Œ
å¹¶ç»™å‡ºè¯¦ç»†ã€å‡†ç¡®çš„æŠ€æœ¯åˆ†æã€‚
"""

agent = create_react_agent(
    knowledge_base=rag_kb,
    model="gpt-4",
    max_tool_calls=8,
    max_steps=15,
    temperature=0.1,
    system_prompt=custom_prompt
)
```

## å·¥å…·è¯¦è§£

### 1. rag_search - æ™ºèƒ½æœç´¢
åœ¨çŸ¥è¯†åº“ä¸­æœç´¢ç›¸å…³æ–‡æ¡£ï¼Œæ”¯æŒç›¸ä¼¼åº¦è¿‡æ»¤å’Œç»“æœæ•°é‡é™åˆ¶ã€‚

```python
result = await toolkit.call_tool("rag_search", {
    "query": "æ•°æ®å¤„ç†æµç¨‹",
    "notebook_id": "20231231120000-xxx",  # å¯é€‰
    "max_results": 5,
    "similarity_threshold": 0.6
})
```

### 2. rag_get_context - è·å–ä¸Šä¸‹æ–‡
è·å–ç‰¹å®šç¬”è®°çš„å®Œæ•´ä¸Šä¸‹æ–‡å†…å®¹ï¼ŒæŒ‰æ–‡æ¡£å—é¡ºåºæ’åˆ—ã€‚

```python
result = await toolkit.call_tool("rag_get_context", {
    "note_id": "20231231120100-yyy",
    "max_chunks": 10
})
```

### 3. rag_multi_query - å¤šæŸ¥è¯¢åˆå¹¶
æ‰§è¡Œå¤šä¸ªç›¸å…³æŸ¥è¯¢å¹¶åˆå¹¶ç»“æœï¼Œæ”¯æŒä¸åŒåˆå¹¶ç­–ç•¥ã€‚

```python
result = await toolkit.call_tool("rag_multi_query", {
    "queries": ["APIæ¥å£", "æ•°æ®å¤„ç†", "é”™è¯¯å¤„ç†"],
    "combine_strategy": "union",  # union, intersection, weighted
    "max_results": 5
})
```

### 4. rag_get_stats - ç»Ÿè®¡ä¿¡æ¯
è·å–çŸ¥è¯†åº“çš„ç»Ÿè®¡ä¿¡æ¯ã€‚

```python
result = await toolkit.call_tool("rag_get_stats", {})
```

## æ¨ç†è¿‡ç¨‹ç¤ºä¾‹

ReAct Agentçš„æ¨ç†è¿‡ç¨‹å¦‚ä¸‹ï¼š

```
1. [æ€è€ƒ] ç”¨æˆ·è¯¢é—®æ•°æ®å¤„ç†æµç¨‹ï¼Œæˆ‘éœ€è¦å…ˆæœç´¢ç›¸å…³æ–‡æ¡£
2. [è¡ŒåŠ¨] è°ƒç”¨rag_searchå·¥å…·ï¼ŒæŸ¥è¯¢"æ•°æ®å¤„ç†æµç¨‹"
3. [è§‚å¯Ÿ] æ‰¾åˆ°äº†3ä¸ªç›¸å…³æ–‡æ¡£ï¼Œå…¶ä¸­åŒ…å«æ•°æ®é¢„å¤„ç†ã€è½¬æ¢å’ŒåŠ è½½çš„æ­¥éª¤
4. [æ€è€ƒ] éœ€è¦æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œè®©æˆ‘æŸ¥æ‰¾å…·ä½“çš„æŠ€æœ¯å®ç°
5. [è¡ŒåŠ¨] è°ƒç”¨rag_multi_queryå·¥å…·ï¼ŒæŸ¥è¯¢["æ•°æ®é¢„å¤„ç†", "æ•°æ®è½¬æ¢", "æ•°æ®åŠ è½½"]
6. [è§‚å¯Ÿ] è·å¾—äº†æ›´è¯¦ç»†çš„æŠ€æœ¯æ–‡æ¡£ï¼ŒåŒ…æ‹¬ç®—æ³•å’Œä»£ç ç¤ºä¾‹
7. [æ€è€ƒ] ç°åœ¨æœ‰è¶³å¤Ÿä¿¡æ¯ï¼Œå¯ä»¥ç»™å‡ºå®Œæ•´ç­”æ¡ˆäº†
8. [æœ€ç»ˆç­”æ¡ˆ] åŸºäºæ”¶é›†çš„ä¿¡æ¯ï¼Œè¯¦ç»†è¯´æ˜æ•°æ®å¤„ç†æµç¨‹...
```

## é…ç½®å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `model` | "gpt-3.5-turbo" | ä½¿ç”¨çš„OpenAIæ¨¡å‹ |
| `max_tool_calls` | 5 | æœ€å¤§å·¥å…·è°ƒç”¨æ¬¡æ•° |
| `max_steps` | 10 | æœ€å¤§æ¨ç†æ­¥æ•° |
| `temperature` | 0.1 | ç”Ÿæˆæ¸©åº¦å‚æ•° |
| `system_prompt` | é»˜è®¤æç¤ºè¯ | ç³»ç»Ÿæç¤ºè¯ |

## æ€§èƒ½å¯¹æ¯”

| ç‰¹æ€§ | ä¼ ç»ŸRAG Agent | ReAct Agent |
|------|---------------|-------------|
| æŸ¥è¯¢æ¨¡å¼ | å•æ¬¡æŸ¥è¯¢ | å¤šè½®æ¨ç† |
| å·¥å…·ä½¿ç”¨ | å›ºå®šæµç¨‹ | åŠ¨æ€é€‰æ‹© |
| ä¿¡æ¯æ•´åˆ | æœ‰é™ | æ™ºèƒ½æ•´åˆ |
| æ¨ç†è¿‡ç¨‹ | ä¸é€æ˜ | å®Œå…¨é€æ˜ |
| å¤æ‚é—®é¢˜å¤„ç† | è¾ƒå¼± | è¾ƒå¼º |
| å»¶è¿Ÿ | è¾ƒä½ | è¾ƒé«˜ |

## ä½¿ç”¨åœºæ™¯

### é€‚åˆä½¿ç”¨ReAct Agentçš„åœºæ™¯ï¼š
- **å¤æ‚é—®é¢˜åˆ†æ**: éœ€è¦ä»å¤šä¸ªè§’åº¦åˆ†æçš„é—®é¢˜
- **æŠ€æœ¯æ–‡æ¡£æŸ¥è¯¢**: éœ€è¦æ•´åˆå¤šä¸ªæŠ€æœ¯æ–‡æ¡£çš„ä¿¡æ¯
- **æµç¨‹è¯´æ˜**: éœ€è¦é€æ­¥è¯´æ˜å¤æ‚æµç¨‹
- **æ¦‚å¿µè§£é‡Š**: éœ€è¦ä»å¤šä¸ªæ¥æºè§£é‡Šæ¦‚å¿µ
- **å¯¹æ¯”åˆ†æ**: éœ€è¦å¯¹æ¯”ä¸åŒæŠ€æœ¯æˆ–æ–¹æ³•

### é€‚åˆä½¿ç”¨ä¼ ç»ŸAgentçš„åœºæ™¯ï¼š
- **ç®€å•äº‹å®æŸ¥è¯¢**: ç›´æ¥æŸ¥æ‰¾ç‰¹å®šä¿¡æ¯
- **å¿«é€Ÿå“åº”**: å¯¹å»¶è¿Ÿè¦æ±‚é«˜çš„åœºæ™¯
- **å•ä¸€æ¥æº**: ä¿¡æ¯æ¥æºç›¸å¯¹å›ºå®š

## æµ‹è¯•å’Œç¤ºä¾‹

### è¿è¡Œæµ‹è¯•
```bash
python test_react_agent.py
```

### è¿è¡Œç¤ºä¾‹
```bash
python example_react_usage.py
```

### äº¤äº’å¼æµ‹è¯•
```bash
python test_react_agent.py
# é€‰æ‹©"äº¤äº’å¼æµ‹è¯•"é€‰é¡¹
```

## æœ€ä½³å®è·µ

### 1. æé—®æŠ€å·§
- **æ˜ç¡®å…·ä½“**: é¿å…æ¨¡ç³Šçš„é—®é¢˜æè¿°
- **åˆ†æ­¥éª¤**: å¯¹å¤æ‚é—®é¢˜å¯ä»¥åˆ†æ­¥æé—®
- **æä¾›ä¸Šä¸‹æ–‡**: ç»™å‡ºç›¸å…³çš„èƒŒæ™¯ä¿¡æ¯

### 2. é…ç½®ä¼˜åŒ–
- **æ¨¡å‹é€‰æ‹©**: å¤æ‚é—®é¢˜ä½¿ç”¨gpt-4ï¼Œç®€å•é—®é¢˜ä½¿ç”¨gpt-3.5-turbo
- **å·¥å…·è°ƒç”¨é™åˆ¶**: æ ¹æ®é—®é¢˜å¤æ‚åº¦è°ƒæ•´max_tool_calls
- **æ¸©åº¦å‚æ•°**: äº‹å®æ€§æŸ¥è¯¢ä½¿ç”¨ä½æ¸©åº¦(0.1)ï¼Œåˆ›é€ æ€§æŸ¥è¯¢å¯ä½¿ç”¨ä¸­ç­‰æ¸©åº¦(0.7)

### 3. ç»“æœè¯„ä¼°
- **æŸ¥çœ‹ç½®ä¿¡åº¦**: å…³æ³¨final_confidenceå€¼
- **æ£€æŸ¥æ¨ç†è¿‡ç¨‹**: é€šè¿‡reasoningäº†è§£Agentçš„æ€è€ƒè¿‡ç¨‹
- **éªŒè¯ä¿¡æ¯æ¥æº**: æŸ¥çœ‹sources_usedç¡®è®¤ä¿¡æ¯å¯é æ€§

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å·¥å…·è°ƒç”¨å¤±è´¥**
   - æ£€æŸ¥çŸ¥è¯†åº“æ˜¯å¦æ­£ç¡®åˆå§‹åŒ–
   - ç¡®è®¤æ€æºç¬”è®°è¿æ¥æ­£å¸¸
   - æŸ¥çœ‹æ—¥å¿—äº†è§£å…·ä½“é”™è¯¯

2. **æ¨ç†å¾ªç¯è¿‡é•¿**
   - è°ƒæ•´max_tool_callså’Œmax_stepså‚æ•°
   - ä¼˜åŒ–ç³»ç»Ÿæç¤ºè¯
   - ä½¿ç”¨æ›´æ˜ç¡®çš„é—®é¢˜è¡¨è¿°

3. **ç­”æ¡ˆè´¨é‡ä¸ä½³**
   - å°è¯•ä½¿ç”¨æ›´å¼ºçš„æ¨¡å‹(gpt-4)
   - è°ƒæ•´ç›¸ä¼¼åº¦é˜ˆå€¼
   - æ£€æŸ¥çŸ¥è¯†åº“å†…å®¹è´¨é‡

### è°ƒè¯•æ¨¡å¼

```python
# å¯ç”¨è¯¦ç»†æ—¥å¿—
import logging
logging.basicConfig(level=logging.DEBUG)

# æŸ¥çœ‹è¯¦ç»†æ¨ç†è¿‡ç¨‹
response = await agent.query(question)
for step in response.reasoning:
    print(f"[{step.step_type}] {step.content}")
    if step.tool_call:
        print(f"  å·¥å…·: {step.tool_call}")
    if step.tool_result:
        print(f"  ç»“æœ: {step.tool_result}")
```

## è´¡çŒ®å’Œåé¦ˆ

æ¬¢è¿æäº¤é—®é¢˜å’Œæ”¹è¿›å»ºè®®ï¼

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ã€‚